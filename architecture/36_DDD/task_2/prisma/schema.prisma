// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ###############
//  課題集約
// ###############
model Task {
  id          String           @id
  name        String
  description String
  progresses  TaskProgresses[]
  updatedAt   DateTime         @updatedAt
  createdAt   DateTime         @default(now())

  @@map("task")
}

model TaskProgresses {
  participantId  String
  participant    Participant    @relation(fields: [participantId], references: [id])
  taskId         String
  task           Task           @relation(fields: [taskId], references: [id])
  progressStatus ProgressStatus @default(NOT_YET_DOING)
  updatedAt      DateTime       @updatedAt
  createdAt      DateTime       @default(now())

  @@unique([participantId, taskId])
  @@map("task_progresses")
}

enum ProgressStatus {
  NOT_YET_DOING
  DOING
  IN_REVIEW
  DONE
}

// ###############
//  参加者集約
// ###############
model Participant {
  id               String                @id
  email            String                @unique
  name             String
  enrollmentStatus EnrollmentStatus      @default(ENROLLMENT)
  progresses       TaskProgresses[]
  pairs            PairWithParticipant[]
  teams            TeamWithParticipant[]
  updatedAt        DateTime              @updatedAt
  createdAt        DateTime              @default(now())

  @@map("participant")
}

enum EnrollmentStatus {
  ENROLLMENT
  ABSENCE
  WITHDRAWAL
}

// ###############
//  ペア集約
// ###############
model Pair {
  id           String                @id
  name         String
  participants PairWithParticipant[]
  updatedAt    DateTime              @updatedAt
  createdAt    DateTime              @default(now())

  @@map("pair")
}

model PairWithParticipant {
  pair          Pair        @relation(fields: [pairId], references: [id])
  pairId        String
  participant   Participant @relation(fields: [participantId], references: [id])
  participantId String
  updatedAt     DateTime    @updatedAt
  createdAt     DateTime    @default(now())

  @@unique([pairId, participantId])
  @@map("pair_with_participant")
}

// ###############
//  チーム集約
// ###############
model Team {
  id           String                @id
  name         String
  participants TeamWithParticipant[]
  updatedAt    DateTime              @updatedAt
  createdAt    DateTime              @default(now())

  @@map("team")
}

model TeamWithParticipant {
  team          Team        @relation(fields: [teamId], references: [id])
  teamId        String
  participant   Participant @relation(fields: [participantId], references: [id])
  participantId String
  updatedAt     DateTime    @updatedAt
  createdAt     DateTime    @default(now())

  @@unique([teamId, participantId])
  @@map("team_with_participant")
}
